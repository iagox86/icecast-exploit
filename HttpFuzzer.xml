<?xml version="1.0" encoding="utf-8"?>
<Peach xmlns="http://phed.org/2012/Peach" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://phed.org/2012/Peach ../peach.xsd">

  <DataModel name="Header1">
    <String name="Header" />
    <String value=": " />
    <String name="Value" />
    <String value="\r\n" />
  </DataModel>
  <DataModel name="Header2">
    <String name="Header" />
    <String value=": " />
    <String name="Value" />
    <String value="\r\n" />
  </DataModel>

  <DataModel name="HttpRequest">
    <Block name="RequestLine">
      <String name="Method" />
      <!--  <String value=" " type="char" /> // XXX: why doesn't type="char" work anymore? -->
      <String value=" " />
      <String name="RequestUri" />
      <String value=" " />
      <String name="HttpVersion" />
      <String value="\r\n" />
    </Block>

    <Block name="HeaderHost" ref="Header1">
      <!--<String name="Header" value="Host" /> -->
      <String name="Header" value="Host" mutable="false" />
    </Block>

    <Block name="HeaderContentLength" ref="Header2">
      <String name="Header" value="Content-Length" />
      <String name="Value">
        <Relation type="size" of="Body" />
      </String>
    </Block>
    <!--<Block name="HeaderContentLength" ref="Header">
      <String name="Header" value="Content-Length" />
      <String name="Value">
        <Relation type="size" of="Body" />
      </String>
    </Block> -->

    <String value="\r\n" />
    <Blob name="Body" minOccurs="0" maxOccurs="1" />
  </DataModel>


  <StateModel name="State1" initialState="Initial">
    <State name="Initial">
      <Action type="output">
        <DataModel ref="HttpRequest" />

        <Data name="HttpGet">
          <Field name="RequestLine.Method" value="GET" />
          <Field name="RequestLine.RequestUri" value="http://localhost" />
          <Field name="RequestLine.HttpVersion" value="HTTP/1.1" />
          <Field name="HeaderHost.Value" value="http://localhost" />
          <Field name="Body" value="Test fuzzzzing" />
        </Data>

      </Action>
    </State>
  </StateModel>

  <StateModel name="State2" initialState="Initial">
    <State name="Initial">
      <Action type="output">
        <DataModel ref="HttpRequest" />
        <Data name="HttpOptions">
          <Field name="RequestLine.method" value="OPTIONS" />
          <Field name="RequestLine.RequestUri" value="*" />
          <Field name="HeaderHost.Value" value="" />
        </Data>
      </Action>
    </State>
  </StateModel>

	<!-- Our Test element will link together our state model and publisher -->
	<Test name="Default">
		<StateModel ref="State1"/>
		
		<!--
			The publisher we select will determin what the actions
			in our state model actually do.  For this example we are
			using the "Stdout" publisher.  This publisher will send any
			"output" actions to the console.
		-->
    <Publisher class="Tcp">
      <Param name="Host" value="192.168.1.105" />
      <Param name="Port" value="8000" />
    </Publisher>

    <Logger class="Filesystem">
      <Param name="Path" value="rontest"/>
    </Logger>

	</Test>

</Peach>
<!-- end -->
